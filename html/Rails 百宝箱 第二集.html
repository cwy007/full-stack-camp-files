
<style>
  .frame {
      margin-left: 30px;
      margin-right: 30px;
  }

  h1, h2, h3, h4, h5, h6 {
      font-weight: normal;
  }

  .view-count {
      float: right;
      margin-top: -54px;
      color: #9B9B9B;
  }

  .markdown h2, .markdown h3, .markdown h4 {
      text-align: left;
      font-weight: 800;
      font-size: 16px !important;
      line-height: 100%;
      margin: 0;
      color: #555;
      margin-top: 16px;
      margin-bottom: 16px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
  }

    .markdown .figure-code figcaption {
      background-color: #e6e6e6;

      font: 100%/2.25 Monaco, Menlo, Consolas, 'Courier New', monospace;
      text-indent: 10.5px;

      -moz-border-radius: 0.25em 0.25em 0 0;
      -webkit-border-radius: 0.25em;
      border-radius: 0.25em 0.25em 0 0;
      -moz-box-shadow: inset 0 0 0 1px #d9d9d9;
      -webkit-box-shadow: inset 0 0 0 1px #d9d9d9;
      box-shadow: inset 0 0 0 1px #d9d9d9;
  }

  .markdown {
      position: relative;
      line-height: 1.8em;
      font-size: 14px;
      text-overflow: ellipsis;
      word-wrap: break-word;
      font-family: 'PT Serif', Georgia, Times, 'Times New Roman', serif !important;
  }

  .markdown ol li, .markdown ul li {
      line-height: 1.6em;
      padding: 2px 0;
      color: #333;
      font-size: 16px;
  }

  .markdown .figure-code {
      margin: 20px 0;
  }

  .post-content {
      padding-top: 5px;
      padding-bottom: 5px;
  }

  .markdown code {
      background-color: #ececec;
      color: #d14;
      font-size: 85%;
      text-shadow: 0 1px 0 rgba(255,255,255,0.9);
      border: 1px solid #d9d9d9;
      padding: 0.15em 0.3em;
  }

  div {
      display: block;
  }

  .markdown figure.code pre {
      background-color: #ffffcc !important;
  }

  .code .gi {
      color: #859900;
      line-height: 1.2em;
  }

  .code .err {
      color: #93A1A1;
  }

  .markdown a:link, .markdown a:visited {
      color: #0069D6 !important;
      text-decoration: none !important;
  }

  .markdown p {
      font-size: 16px;
      line-height: 1.5em;
  }

  .markdown blockquote {
      margin-left: 0 !important;
      margin-right: 0 !important;
      padding: 12px;
      border-left: 5px solid #50AF51;
      background-color: #F3F8F3;
      clear: both;
      display: block;
  }

  .markdown blockquote>*:first-child {
      margin-top: 0 !important;
  }

  .markdown blockquote>*:last-child {
      margin-bottom: 0 !important;
  }

  .markdown blockquote p {
      color: #222;
  }

  * {
      outline: none !important;
  }

  a:active, a:hover, a:link, a:visited {
      text-decoration: none;
  }

  pre {
      margin: 0;
  }

  .markdown img {
      vertical-align: top;
      max-width:100%;
      height:auto;
  }

  h1 a {
    color: #071A52;
  }

  h4 {
    color: #734488;
  }

  hr {
    border-color: #DEDEDE;
    border-width: 0.8px;
    margin-bottom: auto;
  }

  .end {
    height: 400px;
  }

  .end img {
    clear: both;
    display: block;
    margin: 10px auto;
  }

  .end p {
    text-align: center;
    font-size: 2.5em;
    margin: 60px auto 100px;
    color: #ddd;
  }
</style>
<div class='frame'><h1>
      11-1 éœ€æ±‚è¯´æ˜
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š11. é€‰æ—¥æœŸæ—¶é—´çš„ UI</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>ä¹‹å‰æˆ‘ä»¬åœ¨åå°ç¼–è¾‘ User Profile çš„ç”Ÿæ—¥æ—¶ï¼Œç”¨çš„æ˜¯</p>

<figure class="figure-code code"><figcaption><span>app/views/admin/user_profiles/edit.html.erb
</span></figcaption><div class="highlight"><pre><span class="err">&lt;</span>%= f.date_field :birthday, :class =&gt; "form-control" %&gt;

</pre></div>
</figure>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DgdJkBaScma2QZ8CV8Ce_11-3.png" title=""></figure></p>

<p>è¿™ä¸ª UI æ˜¯ç”¨æµè§ˆå™¨å†…å»ºçš„ <code>&lt;input type="date"&gt;</code> è¾“å…¥æ¡†ï¼Œä¸è¿‡å¾ˆå¯æƒœï¼Œè¿™ç§ input é™¤äº† Chrome æµè§ˆå™¨ä¹‹å¤–æ˜¯ä¸å¤ªæ”¯æ´çš„ï¼Œè¯¦è§ <a href="http://caniuse.com/#feat=input-datetime">Can I use?</a> çš„ç»Ÿè®¡èµ„æ–™ã€‚å› æ­¤åå°ç”¨è¿˜å¯ä»¥ï¼Œå› ä¸ºä½ å¯ä»¥è¦æ±‚ç®¡ç†å‘˜ç»Ÿä¸€ç”¨ Chrome æµè§ˆå™¨ï¼Œä½†æ˜¯å‰å°è¦ç»™ä¸€èˆ¬ç”¨æˆ·å°±ä¸å¤ªå¥½äº†ã€‚</p>

<p>Rails ä¹Ÿæœ‰å¦å¤–å†…å»ºä¸€ç§ç”¨ä¸‹æ‹‰é€‰å•çš„æ–¹å¼ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/admin/user_profiles/edit.html.erb
</span></figcaption><div class="highlight"><pre><span class="err">&lt;</span>%= f.date_select :birthday, :class =&gt; "form-control" %&gt;
</pre></div>
</figure>

<p>è¿™ä¼šäº§ç”Ÿä¸‰ä¸ªä¸‹æ‹‰é€‰å•ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/f3ignv3SVij8wJvIHKXt_11-4.png" title=""></figure></p>

<p>è¿™ç§ä¸‹æ‹‰é€‰å•å°±æ²¡æœ‰æµè§ˆå™¨æ”¯æ´çš„é—®é¢˜ï¼Œä½†æ˜¯å°±æ˜¯æœ‰ç‚¹ä¸‘è€Œä¸”æ²¡æœ‰æ—¥å†ï¼Œæˆ‘ä»¬æƒ³è¦ ğŸ“… å•Šã€‚</p>

<p>è¿™ä¸€ç« å°†ä»‹ç»ä½¿ç”¨ <a href="https://uxsolutions.github.io/bootstrap-datepicker/">bootstrap-datepicker</a> è¿™ä¸ª jQuery Pluginï¼Œå¯ä»¥è·å¾—æ—¥å†èˆ¬çš„ç‚¹é€‰æ¥å£ã€‚</p>

<blockquote>
<p>bootstrap-datepicker åªæœ‰æ—¥æœŸï¼Œå¦‚æœéœ€è¦æ—¥æœŸåŠ ä¸Šæ—¶é—´ï¼Œå¯ä»¥ç”¨ <a href="http://eonasdan.github.io/bootstrap-datetimepicker/">bootstrap-datetimepicker</a> è¿™ä¸ª jQuery Pluginï¼Œä»¥åŠåŒ…å¥½çš„ <a href="https://github.com/TrevorS/bootstrap3-datetimepicker-rails">bootstrap3-datetimepicker-rails</a> gemã€‚</p>
</blockquote>

    </div>
  </div></div><div class='frame'><h1>
      11-2 å®‰è£…ä½¿ç”¨ datepicker
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š11. é€‰æ—¥æœŸæ—¶é—´çš„ UI</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p><a href="https://uxsolutions.github.io/bootstrap-datepicker/">bootstrap-datepicker</a> æ˜¯ä¸ª jQuery Pluginï¼Œå¹¶ä¸”æœ‰ç°æˆåŒ…å¥½çš„ gem å¯ä»¥ç›´æ¥ä½¿ç”¨ <a href="https://github.com/Nerian/bootstrap-datepicker-rails">bootstrap-datepicker-rails</a>ã€‚</p>

<p>ç¼–è¾‘ <code>Gemfile</code></p>

<figure class="figure-code code"><figcaption><span>Gemfile
</span></figcaption><div class="highlight"><pre><span class="err">+  gem 'bootstrap-datepicker-rails'
</span></pre></div>
</figure>

<p>æ‰§è¡Œ <code>bundle</code> åï¼Œé‡å¯æœåŠ¡å™¨</p>

<p>ç¼–è¾‘ <code>app/assets/stylesheets/application.scss</code></p>

<figure class="figure-code code"><figcaption><span>app/assets/stylesheets/application.scss
</span></figcaption><div class="highlight"><pre>   @import "bootstrap-sprockets";
   @import "bootstrap";
   @import "select2";
   @import "select2-bootstrap";
<span class="gi">+  @import "bootstrap-datepicker3";
</span><span class="err">
</span></pre></div>
</figure>

<p>ç¼–è¾‘ <code>app/assets/javascripts/application.js</code></p>

<figure class="figure-code code"><figcaption><span>app/assets/javascripts/application.js
</span></figcaption><div class="highlight"><pre>   //= require jquery
   //= require jquery_ujs
   //= require turbolinks
   //= require bootstrap-sprockets
   //= require select2
   //= require nested_form_fields
<span class="gi">+  //= require bootstrap-datepicker/core
+  //= require bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN
</span><span class="err">   //= require_tree .
</span></pre></div>
</figure>

<p>ç¼–è¾‘ <code>app/views/users/edit.html.erb</code>ï¼Œå°† script æ”¾åˆ°æœ€ä¸‹æ–¹ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/users/edit.html.erb
</span></figcaption><div class="highlight"><pre><span class="gd">-  &lt;%= ff.date_field :birthday, :class =&gt; "form-control" %&gt;
</span><span class="gi">+  &lt;%= ff.text_field :birthday, :class =&gt; "form-control" %&gt;
</span>
   # ç•¥

<span class="gi">+  &lt;script&gt;
+    $("#user_profile_attributes_birthday").datepicker({ format: "yyyy-mm-dd" });
+  &lt;/script&gt;
</span><span class="err">
</span></pre></div>
</figure>

<p>æ³¨æ„æ ¼å¼è¦æŒ‡å®šä»¥é…åˆ Railsï¼Œè¿™é‡ŒæŒ‡å®šæˆ <code>"yyyy-mm-dd"</code> å¹´æœˆæ—¥çš„é¡ºåºã€‚</p>

<p>å…¶ä¸­ <code>#user_profile_attributes_birthday</code> è¿™ä¸ª HTML ID å¯ä»¥é€è¿‡ Chrome æŒ‰å³é”®é€è¿‡ Inspect è§‚å¯Ÿå¾—çŸ¥ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/fRMgcp9jQYGbLXq7yNj2_11-0.png" title=""></figure></p>

<p>è¿™æ˜¯æˆæœï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/puMQftqjT1eTRtkjF57q_11-1.png" title=""></figure></p>

<p>å¦‚æœéœ€è¦æ”¯æ´å¤šè¯­è¨€ï¼Œå¯ä»¥æŒ‡å®šè¯­è¨€ï¼š</p>

<figure class="figure-code code"><div class="highlight"><pre>&lt;script&gt;
  $("#user_profile_attributes_birthday").datepicker({ format: "yyyy-mm-dd", language: "&lt;%= I18n.locale %&gt;" });
&lt;/script&gt;
</pre></div>
</figure>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/sR6WptvZQKyT14SR3kAz_11-6.png" title=""></figure></p>

    </div>
  </div></div><div class='frame'><h1>
      12-1 éœ€æ±‚è¯´æ˜
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š12. æ‹†å¼€å‰åå°çš„ CSS å’Œ JS</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>æˆ‘ä»¬å­¦è¿‡å¦‚ä½•æ‹† layout äº†ï¼šé»˜è®¤çš„ layout æ˜¯ <code>app/views/layouts/application.html.erb</code>ï¼Œè€Œåå°çš„ controller æˆ‘ä»¬é€è¿‡ <code>layout "admin"</code> å¯ä»¥æ”¹ç”¨ <code>app/views/layouts/admin.html.erb</code>ã€‚</p>

<p>ä½†æ˜¯æœ‰ä¸ªéƒ¨åˆ†æˆ‘ä»¬æ²¡æœ‰æ‹†å¼€ï¼Œé‚£å°±æ˜¯ css å’Œ javascriptï¼Œåˆ°ç›®å‰è¿˜æ˜¯å…±äº« <code>app/assets/stylesheets/application.scss</code> å’Œ <code>app/assets/javascript/application.js</code>ã€‚</p>

<p>éšç€ Plugins åŠŸèƒ½è¶Šè£…è¶Šå¤šï¼Œæœ‰å¾ˆå¤š css/js å‰åå°æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬åæ¥è£…çš„ <code>select2</code> å’Œ <code>nested_form_fields</code> pluginsï¼Œå‰å°ç›®å‰æ²¡æœ‰ç”¨åˆ°ï¼Œä½†æ˜¯å› ä¸ºå‰åå°å…±äº«çš„å…³ç³»ï¼Œè¿˜æ˜¯è¢«ç”¨æˆ·ä¸‹è½½äº†ã€‚</p>

<p>è¿™éƒ¨åˆ†çš„ css/js ä¹Ÿå¯ä»¥å‰åå°æ‹†å¼€ï¼Œé™¤äº†å¯ä»¥è®©å‰å°ä¸‹è½½æ›´æœ‰æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥è®©ä»£ç åˆ†å¼€ç®¡ç†ã€‚</p>

    </div>
  </div></div><div class='frame'><h1>
      12-2 å®ä½œæ‹†å¼€
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š12. æ‹†å¼€å‰åå°çš„ CSS å’Œ JS</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>æ–°å¢ <code>app/assets/stylesheets/admin.scss</code></p>

<figure class="figure-code code"><div class="highlight"><pre>@import "bootstrap-sprockets";
@import "bootstrap";
@import "select2";
@import "select2-bootstrap";
@import "bootstrap-datepicker3";

</pre></div>
</figure>

<p>æ–°å¢ <code>app/assets/javascripts/admin.js</code></p>

<figure class="figure-code code"><div class="highlight"><pre>//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require bootstrap-sprockets
//= require select2
//= require nested_form_fields
//= require bootstrap-datepicker/core
//= require bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN

</pre></div>
</figure>

<p>ä¿®æ”¹ <code>config/initializers/assets.rb</code></p>

<figure class="figure-code code"><figcaption><span>config/initializers/assets.rb
</span></figcaption><div class="highlight"><pre><span class="o">-</span> <span class="c1"># Rails.application.config.assets.precompile += %w( search.js )
</span>
<span class="o">+</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">assets</span><span class="p">.</span><span class="nf">precompile</span> <span class="o">+=</span> <span class="sx">%w( admin.css admin.js )</span>

</pre></div>
</figure>

<p>è¿™ä¼šå‘Šè¯‰ Rails ç¼–è¯‘ assets æ—¶è¦å¤šç¼–è¯‘è¿™ä¸¤ä¸ªè¿›å…¥ç‚¹æ¡£æ¡ˆã€‚</p>

<p>é‡å¯ Rails æœåŠ¡å™¨</p>

<p>ä¿®æ”¹ <code>app/views/layouts/admin.html.erb</code>ï¼Œæ¢æˆè½½å…¥ admin css å’Œ js</p>

<figure class="figure-code code"><figcaption><span>app/views/layouts/admin.html.erb
</span></figcaption><div class="highlight"><pre><span class="gd">-  &lt;%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %&gt;
</span><span class="gi">+ &lt;%= stylesheet_link_tag    'admin', media: 'all', 'data-turbolinks-track': 'reload' %&gt;
</span>
<span class="gd">-  &lt;%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %&gt;
</span><span class="gi">+  &lt;%= javascript_include_tag 'admin', 'data-turbolinks-track': 'reload' %&gt;
</span><span class="err">
</span></pre></div>
</figure>

<p>æµè§ˆçœ‹çœ‹åå°ï¼Œä¸€åˆ‡åº”æ­£å¸¸ã€‚</p>

<p>å¦‚æœæ£€è§†ä¸€ä¸‹ HTML æºç ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»é¡ºåˆ©æ”¹ç”¨ admin css å’Œ js äº†ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ijBWWSBRlwhp8vw0giOQ_12.png" title=""></figure></p>

<p>æ—¢ç„¶æ˜¯å‰åå°æ‹†å¼€äº†ï¼Œæ¥ç€å¯ä»¥ç˜¦èº«ä¸€ä¸‹å‰å°çš„ css å’Œ jsï¼Œæ¥æŠŠ <code>select2</code> å’Œ <code>nested_form_fields</code> ç§»é™¤ã€‚</p>

<p>ä¿®æ”¹ <code>app/assets/stylesheets/application.scss</code></p>

<figure class="figure-code code"><figcaption><span>app/assets/stylesheets/application.scss
</span></figcaption><div class="highlight"><pre>   @import "bootstrap-sprockets";
   @import "bootstrap";
<span class="gd">-  @import "select2";
-  @import "select2-bootstrap";
</span><span class="err">   @import "bootstrap-datepicker3";
</span></pre></div>
</figure>

<p>ä¿®æ”¹ <code>app/assets/javascripts/application.js</code></p>

<figure class="figure-code code"><figcaption><span>app/assets/javascripts/application.js
</span></figcaption><div class="highlight"><pre>   //= require jquery
   //= require jquery_ujs
   //= require turbolinks
   //= require bootstrap-sprockets
<span class="gd">-  //= require select2
-  //= require nested_form_fields
</span>   //= require bootstrap-datepicker/core
   //= require bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN
   //= require_tree .
<span class="err">
</span></pre></div>
</figure>

<p>æ£€æŸ¥çœ‹çœ‹å‰å°åŠŸèƒ½ï¼Œåº”è¯¥ä¸€åˆ‡æ­£å¸¸ã€‚</p>

    </div>
  </div></div><div class='frame'><h1>
      13-1 å¦‚ä½•æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„ HTML
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š13. Rich Editor ç¼–è¾‘å™¨</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>åå°åœ¨ç¼–è¾‘ Event æè¿°æ—¶ï¼Œç”¨äº†å¤šè¡Œè¾“å…¥æ¡†(text_area)æ¥è¾“å…¥æ´»åŠ¨æè¿°ã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å°è¯•è¿‡è¾“å…¥ HTML ä»£ç ï¼Œç»“æœä¼šæ€ä¹ˆæ ·ï¼Ÿ ä¾‹å¦‚ä»¥ä¸‹çš„è¾“å…¥ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EH5YbHTRheC6bgGkCkbo_13-1.png" title=""></figure></p>
<h4>simple_format</h4>
<p>ç›®å‰åœ¨ <code>app/views/admin/events/show.html.erb</code> é¡µé¢ä¸Šï¼Œæ˜¾ç¤ºçš„éƒ¨åˆ†æ˜¯ç”¨ <code>&lt;%= simple_format @event.description %&gt;</code>ï¼Œç»“æœæ˜¯ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/vf3WOd2jQWi67nbZZz5B_13-2.png" title=""></figure></p>

<p>å¥½åƒå“ªé‡Œæ€ªæ€ªçš„ï¼Œé¢œè‰²è·Ÿè¡¨æ ¼ä¸è§äº†ï¼Œè§‚å¯Ÿçœ‹çœ‹åŸå§‹ç :</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/S4SkfbgQjqxJ8rGKV4ti_13-3.png" title=""></figure></p>

<p>è·Ÿå½“åˆè¾“å…¥çš„ä¸ä¸€æ ·ï¼Œ<code>table</code> æ ‡ç±¤ä¸è§äº†ã€<code>style</code>å±æ€§ä¹Ÿä¸è§äº†ã€‚è¿™æ˜¯å› ä¸º simple_format çš„å®‰å…¨æœºåˆ¶ä¼šè¿‡æ»¤ HTML çš„è¾“å‡ºã€‚</p>

<p>å¦å¤–ï¼Œ<code>simple_format</code> çš„ä½œç”¨æ˜¯æ¢è¡Œï¼šåœ¨è¾“å…¥æ¡†ä¸­çš„æ¢è¡Œï¼Œè¾“å‡ºæ—¶ä¼šå¤šåŒ…ä¸€ä¸ª <code>&lt;p&gt;</code> æ ‡ç±¤æ¥åŒºåˆ†æ®µè½ã€‚è¿™é‡Œä¹Ÿçœ‹å‡ºäº† <code>simple_format</code> å…¶å®ä¸é€‚åˆç”¨åœ¨ç”¨æˆ·è¾“å…¥ HTML çš„æƒ…å†µï¼Œå› ä¸ºå®ƒä¼šè‡ªä½œèªæ˜å¤šåŒ…ä¸€å±‚ <code>&lt;p&gt;</code>ã€‚</p>
<h4>ç§»é™¤ simple_formatï¼Œæ”¹å› Rails é»˜è®¤è¾“å‡ºè¡Œä¸º</h4>
<p>é‚£å¦‚æœä¸è¦ç”¨ <code>simple_format</code> helper å‘¢ï¼Œæ¥æ”¹æˆ <code>&lt;%= @event.description %&gt;</code>ï¼Œç»“æœæ˜¯ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rrizmUckRh6l2qhIv1CM_13-4.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/0oNUFg5kRrokTkLmZPbW_13-5.png" title=""></figure></p>

<p>è¿™ä¸‹å­ HTML å®Œå…¨è¢«è„±é€¸(escaped)äº†ï¼Œä¾‹å¦‚ <code>&lt;</code> ä¼šå˜æˆ <code>&amp;lt;</code>ã€‚è¿™æ˜¯ Rails é»˜è®¤çš„å®‰å…¨æœºåˆ¶ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬è¿™é‡Œæƒ³è¦çš„ç»“æœã€‚</p>
<h4>raw æˆ– html_safe</h4>
<p>é‚£å¯ä»¥å« Rails ä¸è¦è„±é€¸ HTML å—ï¼Ÿæ¥æ”¹æˆ <code>&lt;%= raw @event.description %&gt;</code> æˆ– <code>&lt;%= @event.description.html_safe %&gt;</code></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4jRtbMrAS1ys9WlRTZZl_13-6.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/sXUNF3gFRKuBe8mZnWgv_13-7.png" title=""></figure></p>

<p>ç»“æœçœ‹èµ·æ¥å¯¹äº†ï¼Œä½†æ˜¯ Rails æ—¢ç„¶é»˜è®¤ä¼šè„±é€¸ HTMLï¼Œæƒ³å¿…æœ‰å…¶è®¾è®¡çš„é“ç†å§ï¼Ÿæ²¡é”™ï¼Œè¿™çš„ç¡®ä¼šé€ æˆå®‰å…¨æ€§çš„é—®é¢˜ï¼Œä¾‹å¦‚ç”¨æˆ·å¯ä»¥è¾“å…¥ JavaScript ç¨‹åºï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/V7ul5K9sTUGNtmsyOL2L_13-8-hack.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rEpVyrfoRQqniUSFKMZA_13-9-hackyou.png" title=""></figure></p>

<p>è¿™ä¹ˆå½“å…¶ä»–ç”¨æˆ·æµè§ˆåˆ°è¿™ä¸€é¡µæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šç›²ç›®çš„æ‰§è¡Œè¿™æ®µ JavaScript ä»£ç ï¼Œä¾‹å¦‚è¿™é‡Œä¼šè·³å‡ºæ¼äººçš„ <code>alert</code> è§†çª—ï¼Œè€Œæ¶æ„çš„éª‡å®¢ä¼šæ¤å…¥é‚ªæ¶çš„ JavaScript ç¨‹åºï¼Œä¾‹å¦‚è¾“å…¥ <code>&lt;script&gt;location.href='https://ihower.tw'&lt;/script&gt;</code> å°±ä¼šæŠŠç”¨æˆ·éª—å» ihower è€å¸ˆçš„ç½‘é¡µ ğŸ˜µğŸ˜µğŸ˜µ æˆ–æ˜¯åˆ é™¤ç”¨æˆ·èµ„æ–™æˆ–çªƒå–ç™»å…¥æƒé™ç­‰ç­‰ã€‚è¿™ç§æ”»å‡»æ–¹å¼å«åš <a href="https://zh.wikipedia.org/zh-cn/%E8%B7%A8%E7%BD%91%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A0%81">XSS</a> è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯æœ€å¸¸è§çš„ç½‘ç»œæ”»å‡»æ‰‹æ³•ä¹‹ä¸€ã€‚ä»»ä½•ç½‘ç«™åªè¦å…è®¸ç”¨æˆ·è¾“å…¥èµ„æ–™ï¼Œå°±æœ‰è¿™ä¸ªé£é™©ã€‚é˜²èŒƒçš„æ–¹å¼å°±æ˜¯åœ¨è¾“å‡ºæ—¶ï¼Œè¿›è¡Œè¿‡æ»¤æˆ–ä¸€å¾‹è„±é€¸ã€‚</p>

<p>è€Œå½“æˆ‘ä»¬ç”¨ <code>raw</code> æˆ– <code>html_safe</code> çš„è¯ï¼Œå°±æ˜¯å‘Šè¯‰ Rails è¿™ä¸ªè¾“å‡ºå­—ä¸²æ˜¯å®‰å…¨çš„ã€‚</p>

<blockquote>
<p>å½“ç„¶ï¼Œåœ¨è¿™ä¸ªæƒ…å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾èƒ½è¿›å…¥åå°çš„ç”¨æˆ·å°±æ˜¯å¯ä¿¡ä»»çš„ç®¡ç†å‘˜ï¼Œåº”è¯¥ä¸ä¼šè‡ªå·±éª‡è‡ªå·±çš„ç½‘ç«™ï¼Œå› æ­¤ç›´æ¥ <code>raw</code> è¾“å‡ºå½“æ˜¯æ— å¦¨ã€‚ä½†å¦‚æœæ˜¯ä¸€èˆ¬ç”¨æˆ·åœ¨å‰å°è¾“å…¥ã€ç¼–è¾‘è‡ªå·±çš„ä¸ªäººèµ„æ–™ï¼Œå°±ä¸èƒ½ä¿¡ä»»äº†ã€‚</p>
</blockquote>
<h4>sanitize ç™½åå•è¿‡æ»¤</h4>
<p>éœ€è¦æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„ HTML åˆè¦æœ‰å®‰å…¨æ€§ï¼Œé‚£å°±éœ€è¦ä¸€ç§ç™½åå•çš„è¿‡æ»¤æœºåˆ¶äº†ï¼ŒRails æä¾›äº† <code>sanitize</code> helperã€‚</p>

<p>è¯·ä¿®æ”¹ <code>app/views/admin/events/show.html.erb</code></p>

<figure class="figure-code code"><figcaption><span>
</span></figcaption><div class="highlight"><pre>-  &lt;%= simple_format @event.description %&gt;
+  &lt;%= sanitize @event.description %&gt;
</pre></div>
</figure>

<p>ä»¥åŠå‰å°çš„ <code>app/views/events/show.html.erb</code></p>

<figure class="figure-code code"><figcaption><span>
</span></figcaption><div class="highlight"><pre>-  &lt;%= simple_format @event.description %&gt;
+  &lt;%= sanitize @event.description %&gt;
</pre></div>
</figure>

<p>ç»“æœï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/FzKAIVKLTj2Z85LhzfCl_13-10-sanitize.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7bxvvNS4R9qNmLUB3GLm_13-11.png" title=""></figure></p>

<p>çœ‹èµ·æ¥æ¯”è¾ƒæ­£å¸¸äº†ï¼Œæ¯”èµ· <code>simple_format</code> ä¸ä¼šå¤šç®¡é–’äº‹å¤šåŒ… <code>&lt;p&gt;</code> æ ‡ç±¤ï¼Œä½†æ˜¯è¿˜æ˜¯å°‘äº† <code>table</code> æ ‡ç±¤å’Œ <code>style</code> å±æ€§ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤çš„ç™½åå•æ˜¯ï¼š</p>

<ul>
<li>å…è®¸çš„ HTML æ ‡ç±¤ <code>strong em b i p code pre tt samp kbd var sub
    sup dfn cite big small address hr br div span h1 h2 h3 h4 h5 h6 ul ol li dl dt dd abbr
    acronym a img blockquote del ins</code>
</li>
<li>å…è®¸çš„ HTML å±æ€§ <code>href src width height alt cite datetime title class name xml:lang abbr</code>
</li>
</ul>

<p>æ°å·§ table è·Ÿ style ä¸åœ¨é‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±åŠ ã€‚è¯·ä¿®æ”¹ <code>config/application.rb</code></p>

<figure class="figure-code code"><figcaption><span>config/application.rb 
</span></figcaption><div class="highlight"><pre>
  class Application &lt; Rails::Application 
    config.i18n.default_locale = "zh-CN"
    config.time_zone = "Beijing"
    
<span class="gi">+   config.action_view.sanitized_allowed_tags = Rails::Html::WhiteListSanitizer.allowed_tags + %w(table tr td) 
+   config.action_view.sanitized_allowed_attributes = Rails::Html::WhiteListSanitizer.allowed_attributes + %w(style border) 
</span>  end
<span class="err">   
</span></pre></div>
</figure>

<p>é‡å¯æœåŠ¡å™¨ï¼Œå†çœ‹ä¸€æ¬¡ç»“æœï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xxwQowAOQUuAAmOnH2n5_13-12-ok.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/2o7IqjStQxSlFj7Qt25z_13-13-ok.png" title=""></figure></p>

<p>è¿™æ ·å°±æ—¢æ»¡è¶³å®‰å…¨æ€§è¦æ±‚ï¼Œåˆè¾¾åˆ°æˆ‘ä»¬è¦çš„ç»“æœäº†ã€‚</p>

    </div>
  </div></div><div class='frame'><h1>
      13-2 è¾“å…¥ HTMLï¼šä½¿ç”¨ Rich Editor
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š13. Rich Editor ç¼–è¾‘å™¨</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>ä¸Šä¸€èŠ‚ä¸­ï¼Œå°±ç®—æˆ‘ä»¬å…è®¸ HTML è¾“å…¥ï¼Œä½†æ˜¯é‚£ä¸ªè¾“å…¥çš„ç•Œé¢å´ä¸æ˜¯æ™®é€šäººå¯ä»¥æ¥å—çš„ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬ç”¨å¦å¤–å®‰è£…æ‰€è§å³æ‰€å¾—(WYSIWYG) çš„ç¼–è¾‘å™¨ï¼Œåˆå«åš Rich Editorã€‚</p>

<p>è¿™ç§ç¼–è¾‘å™¨æ˜¯ä¸€ç§å‰ç«¯ Pluginï¼Œä»Šå¤©å«ç¤ºèŒƒå®‰è£…å…¶ä¸­ä¸€å¥—å«åš <a href="http://ckeditor.com">ckeditor</a>ï¼Œè¿™æœ‰ç°æˆçš„ Rails gem <a href="https://github.com/galetahub/ckeditor" rel="nofollow" target="_blank">https://github.com/galetahub/ckeditor</a> å¯ä»¥ç›´æ¥å®‰è£…æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>

<p>ä¿®æ”¹ <code>Gemfile</code></p>

<figure class="figure-code code"><figcaption><span>Gemfile
</span></figcaption><div class="highlight"><pre><span class="gi">+  gem 'ckeditor'
</span><span class="err">
</span></pre></div>
</figure>

<p>ç¼–è¾‘ <code>app/assets/javascripts/admin.js</code></p>

<figure class="figure-code code"><figcaption><span>
</span></figcaption><div class="highlight"><pre>  //= require jquery
  //= require jquery_ujs
  //= require turbolinks
  //= require bootstrap-sprockets
  //= require select2
  //= require nested_form_fields
  //= require bootstrap-datepicker/core
  //= require bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN
<span class="gi">+ //= require ckeditor/init
</span><span class="err">
</span></pre></div>
</figure>

<p>ç¼–è¾‘ <code>app/views/admin/events/_form.html.erb</code></p>

<figure class="figure-code code"><figcaption><span>app/views/admin/events/_form.html.erb
</span></figcaption><div class="highlight"><pre><span class="gd">-  &lt;%= f.text_area :description, :class =&gt; "form-control" %&gt;
</span><span class="gi">+  &lt;%= f.cktext_area :description, ckeditor: { language: 'zh-CN'} %&gt;
</span><span class="err">
</span></pre></div>
</figure>

<blockquote>
<p>å¦‚æœç”¨ <code>simple_form</code> çš„è¯ï¼Œå¯ä»¥ç”¨ <code>f.input :description, as: :ckeditor</code></p>
</blockquote>

<p>ç¼–è¾‘ <code>config/initializers/assets.rb</code></p>

<figure class="figure-code code"><figcaption><span>config/initializers/assets.rb
</span></figcaption><div class="highlight"><pre><span class="gd">-  # Rails.application.config.assets.precompile += %w( admin.css admin.js )
</span><span class="gi">+  Rails.application.config.assets.precompile += %w( admin.css admin.js ckeditor/* )
</span><span class="err">
</span></pre></div>
</figure>

<p>è¿è¡Œ bundleï¼Œé‡å¯ Rails server</p>

<p>ç¼–è¾‘çœ‹çœ‹ Event å°±æœ‰å‰å®³çš„ç¼–è¾‘å™¨äº†ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/FhLZMXHCQLyh7C2EYnlc_13-14-ckeditor.png" title=""></figure></p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/vtatM3mSgut7JUN3S5BO_13-15.png" title=""></figure></p>

<p>å¦‚æœè§‰å¾—é»˜è®¤çš„å·¥å…·åˆ—(toolbar)å¤ªå¤æ‚ï¼Œå¯ä»¥æ”¹ç”¨ mini toolbar é…ç½®ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/admin/events/_form.html.erb
</span></figcaption><div class="highlight"><pre><span class="gd">-  &lt;%= f.cktext_area :description, ckeditor: { language: 'zh-CN'} %&gt;
</span><span class="gi">+  &lt;%= f.cktext_area :description, ckeditor: { toolbar: 'mini', language: 'zh-CN'} %&gt;
</span><span class="err">
</span></pre></div>
</figure>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/h7iXwOsT7qfaigj0bHab_13-16.png" title=""></figure></p>

<p>Ckeditor è¿˜å¯ä»¥è¿›ä¸€æ­¥è‡ªè®¢ä¹‰å·¥å…·åˆ—çš„é•¿ç›¸ï¼Œå°±è¯·è‡ªè¡Œå‚è€ƒæ–‡æ¡£äº†ã€‚</p>

    </div>
  </div></div><div class='frame'><h1>
      14-1 éœ€æ±‚è¯´æ˜
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š14. æ‰¹æ¬¡ç¼–è¾‘ (Bulk Editing)</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>åœ¨åå°ç¼–è¾‘èµ„æ–™æ—¶ï¼Œå¦‚æœèµ„æ–™å¾ˆå¤šï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆ UI å¯ä»¥ä¸€æ¬¡ä¿®æ”¹æˆ–åˆ é™¤å¤šç¬”å‘¢ï¼Ÿ è¿™ä¸€ç« å°†å®ä½œé€è¿‡æ ¸é€‰æ–¹å—æ¥åšæ‰¹æ¬¡åˆ é™¤å’Œä¿®æ”¹ã€‚</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n59xy2wAQSCp8SsqjomP_14-2.png" title=""></figure></p>

<p>å‹¾é€‰è¦ä¿®æ”¹å“ªäº›æ´»åŠ¨ï¼ŒæŒ‰ä¸‹æœ€ä¸‹é¢çš„æŒ‰é’®å°±ä¼šæ‰¹æ¬¡ä¿®æ”¹ã€‚</p>

    </div>
  </div></div><div class='frame'><h1>
      14-2 æ‰¹æ¬¡åˆ é™¤
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š14. æ‰¹æ¬¡ç¼–è¾‘ (Bulk Editing)</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>å…ˆæ¥åšæ‰¹æ¬¡åˆ é™¤ï¼Œé¦–å…ˆéœ€è¦ä¿®æ”¹ <code>config/routes.rb</code>ï¼ŒåŠ ä¸Šä¸€ä¸ªæ–°çš„è·¯ç”±æ¥åšæ‰¹æ¬¡åŠ¨ä½œï¼š</p>

<figure class="figure-code code"><figcaption><span>config/routes.rb
</span></figcaption><div class="highlight"><pre>resources :events do
  resources :tickets, :controller =&gt; "event_tickets"

<span class="gi">+      collection do
+        post :bulk_update
+      end
</span><span class="err">end
</span></pre></div>
</figure>

<p>ä¿®æ”¹ <code>app/views/admin/events/index.html.erb</code>ï¼Œç”¨ <code>form_tag</code> åŒ…ä½æ•´ä¸ª <code>table</code>ï¼Œå¹¶åŠ ä¸Šæ ¸é€‰æ–¹å—å’Œæ‰¹æ¬¡åˆ é™¤çš„æŒ‰é’®ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/admin/events/index.html.erb
</span></figcaption><div class="highlight"><pre><span class="gi">+  &lt;%= form_tag bulk_update_admin_events_path, :class =&gt; "form-inline" do %&gt;
</span>   &lt;table class="table"&gt;
   &lt;tr&gt;
<span class="gi">+    &lt;th&gt;&lt;%= check_box_tag "å…¨é€‰", "1", false, :id =&gt; "toggle_all" %&gt;&lt;/th&gt;
</span>
   # ç•¥

   &lt;% @events.each do |event| %&gt;
    &lt;tr&gt;
<span class="gi">+     &lt;td&gt;
+       &lt;%= check_box_tag "ids[]", event.id %&gt;
+     &lt;/td&gt;
</span>
   # ç•¥

   &lt;/table&gt;

<span class="gi">+    &lt;p&gt;&lt;%= submit_tag "æ‰¹æ¬¡åˆ é™¤", :class =&gt; "btn btn-danger", :data =&gt; { :confirm =&gt; "Are you sure?" } %&gt;&lt;/p&gt;
+  &lt;% end %&gt;
</span>
<span class="gi">+  &lt;script&gt;
+    // è¿™ä¸ª javascript ä¼šç»‘äº‹ä»¶åœ¨ #toggle_all æ ¸é€‰æ–¹å—ä¸Šï¼Œæ¥åšå…¨é€‰æ•ˆæœ
+    $("#toggle_all").click(function(){
+      if ( $(this).prop("checked") ) {
+        $("input[name='ids[]']").prop("checked", true);
+      } else {
+        $("input[name='ids[]']").prop("checked", false);
+      }
+    })
+  &lt;/script&gt;
</span><span class="err">
</span></pre></div>
</figure>

<p>ä¿®æ”¹ <code>app/controllers/admin/events_controller.rb</code>ï¼Œå¾ªç¯ <code>params[:ids]</code> æ•°ç»„æ‰¾å‡ºæ¯ä¸ª event ç„¶ååˆ é™¤ã€‚</p>

<figure class="figure-code code"><figcaption><span>app/controllers/admin/events_controller.rb
</span></figcaption><div class="highlight"><pre><span class="gi">+  def bulk_update
+    total = 0
+    Array(params[:ids]).each do |event_id|
+      event = Event.find(event_id)
+      event.destroy
+      total += 1
+    end
+
+    flash[:alert] = "æˆåŠŸå®Œæˆ #{total} ç¬”"
+    redirect_to admin_events_path
</span><span class="err">+  end
</span></pre></div>
</figure>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/5TDfv99jRj2d1Mh8nUQY_14-1.png" title=""></figure></p>

<p>è¿™æ ·å°±å¯ä»¥æ‰¹æ¬¡åˆ é™¤äº†ã€‚</p>

<blockquote>
<p>Pro Tip å°æŠ€å·§ï¼šå…³äº <code>Array(params[:ids]</code> è¿™ä¸ªç”¨æ³•ï¼Œå¦‚æœæ˜¯ <code>Array([1,2,3])</code> ä¼šç­‰åŒäº <code>[1,2,3]</code> æ²¡å˜ï¼Œä½†æ˜¯ <code>Array[nil]</code> ä¼šå˜æˆ <code>[]</code> ç©ºæ•°ç»„ï¼Œè¿™å¯ä»¥è®© <code>.each</code> æ–¹æ³•ä¸ä¼šå› ä¸º <code>nil.each</code> è€Œçˆ†é”™ã€‚å¦‚æœä¸è¿™æ ·å¤„ç†ï¼Œåœ¨æ²¡æœ‰å‹¾é€‰ä»»ä½•æ´»åŠ¨å°±é€å‡ºçš„æƒ…å†µï¼Œå°±ä¼šçˆ†å‡º NoMethodError é”™è¯¯ã€‚é™¤éä½ é¢å¤–æ£€æŸ¥ <code>params[:id]</code> å¦‚æœæ˜¯ <code>nil</code> å°±è¿”å›ï¼Œä½†ä¸å¦‚ç”¨ <code>Array</code> æ¥çš„ç²¾å·§ã€‚</p>
</blockquote>

<p>æ³¨æ„æœ¬æ¥çš„ admin layout ä¸­çš„ flash æ ·å¼æœ‰ç‚¹é—®é¢˜ï¼Œè¯·ä¿®æ”¹ <code>app/views/layouts/admin.html.erb</code> ä¿®æ­£ä¸€ä¸‹ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/layouts/admin.html.erb
</span></figcaption><div class="highlight"><pre><span class="gd">-    &lt;div class="container"&gt;
</span><span class="gi">+    &lt;div class="container" style="padding-top: 60px"&gt;
</span>
<span class="gd">-      &lt;p class="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;
-      &lt;p class="alert"&gt;&lt;%= alert %&gt;&lt;/p&gt;
</span>
<span class="gi">+      &lt;% if notice %&gt;
+        &lt;p class="notice alert-success"&gt;&lt;%= notice %&gt;&lt;/p&gt;
+      &lt;% end %&gt;
</span>
<span class="gi">+      &lt;% if alert %&gt;
+        &lt;p class="alert alert-danger"&gt;&lt;%= alert %&gt;&lt;/p&gt;
</span><span class="err">+      &lt;% end %&gt;
</span></pre></div>
</figure>

    </div>
  </div></div><div class='frame'><h1>
      14-3 æ‰¹æ¬¡ä¿®æ”¹
    </h1><h4>æ‰€å±ç« èŠ‚ï¼š14. æ‰¹æ¬¡ç¼–è¾‘ (Bulk Editing)</h4><hr><div class="post group">
    <div class="post-content markdown">
      <p>æ¥ä¸‹æ¥å®ä½œæ‰¹æ¬¡ä¿®æ”¹çŠ¶æ€ã€‚æ³¨æ„åˆ°æˆ‘ä»¬å·²ç»åŒ…äº†ä¸€ä¸ª <code>form</code> åœ¨ <code>table</code> å¤–é¢äº†ï¼š</p>

<ul>
<li>ä¸€ä¸ª form çš„é€å‡º URL ä½ç½®æ˜¯å›ºå®šçš„ï¼Œä¼šè¿›åˆ°åŒä¸€ä¸ª actionã€‚è¿™é‡Œä¼š POST é€å‡ºåˆ° <code>bulk_update_admin_events_path</code>
</li>
<li>
<code>form</code> é‡Œé¢ä¸èƒ½å†åŒ… <code>form</code>
</li>
</ul>

<p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆåŒºåˆ«åˆ°åº•æ˜¯è¦åˆ é™¤è¿˜æ˜¯ä¿®æ”¹ï¼Ÿæ‰€å¹¸ï¼ŒæŒ‰é’®çš„æ–‡å­—ä¹Ÿä¼šé€å‡ºå˜æˆå‚æ•°ã€‚è¯·ä¿®æ”¹ <code>app/views/admin/events/index.html.erb</code>ï¼ŒåŠ ä¸Šæ‰¹æ¬¡ä¿®æ”¹çš„æŒ‰é’®ï¼Œä»¥åŠçŠ¶æ€çš„ä¸‹æ‹‰é€‰å•ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/views/admin/events/index.html.erb
</span></figcaption><div class="highlight"><pre>   &lt;/table&gt;

<span class="gd">-   &lt;p&gt;&lt;%= submit_tag "æ‰¹æ¬¡åˆ é™¤", :class =&gt; "btn btn-danger", :data =&gt; { :confirm =&gt; "Are you sure?" } %&gt;&lt;/p&gt;
</span>
<span class="gi">+   &lt;p&gt;
+   &lt;%= select_tag :event_status, options_for_select( Event::STATUS.map{ |s| [t(s, :scope =&gt; + "event.status"), s] }), :class =&gt; "form-control" %&gt;
+
+   &lt;%= submit_tag t(:bulk_update), :class =&gt; "btn btn-primary" %&gt;
+   &lt;%= submit_tag t(:bulk_delete), :class =&gt; "btn btn-danger", :data =&gt; { :confirm =&gt; "Are you + sure?" } %&gt;
+   &lt;/p&gt;
</span>
  &lt;% end %&gt;
<span class="err">
</span></pre></div>
</figure>

<p>ä¿®æ”¹ <code>config/locales/zh-CN.yml</code></p>

<figure class="figure-code code"><figcaption><span>config/locales/zh-CN.yml
</span></figcaption><div class="highlight"><pre>   "zh-CN":
<span class="gi">+    bulk_update: æ‰¹æ¬¡ç¼–è¾‘
+    bulk_delete: æ‰¹æ¬¡åˆ é™¤
</span><span class="err">
</span></pre></div>
</figure>

<blockquote>
<p>å¦‚æœè¦åšè‹±æ–‡ç‰ˆï¼Œè¯·å†ç¼–è¾‘ en.yml åŠ ä¸Šè‹±æ–‡ç¿»è¯‘å³å¯</p>
</blockquote>

<p>å¦‚æœè§‚å¯Ÿä¸€ä¸‹ HTML æºç ï¼Œå¯ä»¥çœ‹åˆ°æŒ‰é’®ä¹Ÿæ˜¯æœ‰å‚æ•°çš„ï¼š</p>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/icBx4QySZe3g4RHWK62m_14-3.png" title=""></figure></p>

<p>æ¥ç€ä¿®æ”¹ <code>app/controllers/admin/events_controller.rb</code>ï¼Œæ ¹æ® <code>params[:commit]</code> å‚æ•°ï¼Œå°±å¯ä»¥åˆ¤æ–­ç”¨æˆ·å½“åˆæ˜¯æŒ‰ä¸‹åˆ é™¤è¿˜æ˜¯ä¿®æ”¹äº†ï¼š</p>

<figure class="figure-code code"><figcaption><span>app/controllers/admin/events_controller.rb
</span></figcaption><div class="highlight"><pre>
     Array(params[:ids]).each do |event_id|
       event = Event.find(event_id)
<span class="gd">-      event.destroy
-      total += 1
</span><span class="gi">+
+      if params[:commit] == I18n.t(:bulk_update)
+        event.status = params[:event_status]
+        if event.save
+          total += 1
+        end
+      elsif params[:commit] == I18n.t(:bulk_delete)
+        event.destroy
+        total += 1
+      end
</span>     end
<span class="err">
</span></pre></div>
</figure>

<p><figure><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/sMOVxKR4RVepfCD0fiYY_14-2.png" title=""></figure></p>

<blockquote>
<p>Pro Tip å°æŠ€å·§ï¼šè¿™é‡Œ ihower è€å¸ˆæ”¹ç”¨äº† I18n æ¥æ˜¾ç¤ºæŒ‰é’®å­—ä¸²ï¼Œè¿™å€’ä¸æ˜¯å› ä¸ºä¸€å®šè¦æ”¯æ´å¤šè¯­è¨€ï¼Œè€Œæ˜¯å› ä¸ºæ–‡æ¡ˆå¯èƒ½ä¼šæ”¹ã€‚å¦‚æœä½ æŒ‰é’®å†™æ­» <code>&lt;%= submit_tag 'æ‰¹æ¬¡ä¿®æ”¹'</code> çš„è¯ï¼Œé‚£ä¹ˆåœ¨ controller ä¸­ä¹Ÿéœ€è¦å†™æˆ <code>if params[:commit] == 'æ‰¹æ¬¡ä¿®æ”¹'</code>ã€‚å°†æ¥é‚£ä¸€å¤©è¦æ”¹å­—ï¼Œå°±è¦è®°å¾—ä¸¤ä¸ªåœ°æ–¹éƒ½è¦æ”¹åˆ°ã€‚ä½†æ˜¯å¦‚æœç”¨ I18n æ¥å¤„ç†ï¼Œå°±ä¹‹ååªè¦è®°å¾—æ”¹ç¿»è¯‘æ¡£ä¸€ä¸ªåœ°æ–¹å°±å¥½äº†ã€‚è¿™ä¸ªåŸåˆ™å°±å«åš <a href="https://zh.wikipedia.org/wiki/%E4%B8%80%E6%AC%A1%E4%B8%94%E4%BB%85%E4%B8%80%E6%AC%A1">DRY: Don't repeat yourself</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªå†™å¥½ç¨‹åºçš„åŸºæœ¬åŸåˆ™ã€‚</p>
</blockquote>

    </div>
  </div></div><div class='end'>
              <a href='https://fullstack.qzy.camp/'>
                <img src='https://img.buzzfeed.com/buzzfeed-static/static/2014-10/26/6/enhanced/webdr08/longform-original-14836-1414320930-10.jpg'>
              </a>
              <p>The End</p>
            </div>